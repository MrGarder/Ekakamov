<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–º—å–µ–π | Ekakamov</title>
    <style>
        body { background: #050505; color: #fff; font-family: sans-serif; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        .form-card { background: #111; padding: 20px; border-radius: 10px; border: 1px solid #8b0000; margin-bottom: 30px; }
        h2 { color: #ff0000; text-transform: uppercase; text-align: center; }
        input, select, button { padding: 10px; margin: 5px; border-radius: 5px; border: 1px solid #333; background: #000; color: #fff; }
        .btn-add { background: #8b0000; cursor: pointer; border: none; font-weight: bold; width: 100%; margin-top: 10px; }
        
        table { width: 100%; border-collapse: collapse; background: #111; border-radius: 10px; overflow: hidden; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #222; }
        th { background: #8b0000; color: #fff; }
        
        .warn-btn { background: #333; border: 1px solid #444; cursor: pointer; padding: 2px 8px; margin: 0 2px; font-weight: bold; }
        .warn-btn:hover { background: #ff0000; }
        .btn-edit { background: #2196F3; border: none; cursor: pointer; padding: 5px 10px; }
        .btn-del { background: #f44336; border: none; cursor: pointer; padding: 5px 10px; }
        .status-online { color: lime; }
        .status-offline { color: red; }
        .warn-count { font-weight: bold; color: #ffeb3b; display: inline-block; width: 30px; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-card">
            <h2>–î–æ–±–∞–≤–∏—Ç—å / –ò–∑–º–µ–Ω–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</h2>
            <div style="display: flex; flex-wrap: wrap; justify-content: center;">
                <input type="password" id="pass" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞" style="width: 95%;">
                <input type="text" id="name" placeholder="–ù–∏–∫ –∏–≥—Ä–æ–∫–∞">
                <select id="rank">
                    <option value="[10] –ì–ª–∞–≤–∞">–ì–ª–∞–≤–∞ [10]</option>
                    <option value="[9] –ó–∞–º. –ì–ª–∞–≤—ã">–ó–∞–º. –ì–ª–∞–≤—ã [9]</option>
                    <option value="[8] –ì–æ–ª—å–¥">–ì–æ–ª—å–¥ [8]</option>
                    <option value="[7] –®–µ—Ä—Ö">–®–µ—Ä—Ö [7]</option>
                    <option value="[6] –≠–ª–∏—Ç">–≠–ª–∏—Ç [6]</option>
                    <option value="[5] –í–µ—Ç–µ—Ä–∞–Ω">–í–µ—Ç–µ—Ä–∞–Ω [5]</option>
                    <option value="[4] –ë–æ–µ—Ü">–ë–æ–µ—Ü [4]</option>
                    <option value="[3] –ù–æ–≤–∏—á–æ–∫+">–ù–æ–≤–∏—á–æ–∫+ [3]</option>
                    <option value="[2] –†–∞–≤–∫">–†–∞–≤–∫ [2]</option>
                    <option value="[1] –ö–∞–Ω–¥–∏–¥–∞—Ç">–ö–∞–Ω–¥–∏–¥–∞—Ç [1]</option>
                </select>
                <input type="number" id="warns" placeholder="–í—ã–≥–æ–≤–æ—Ä—ã" value="0" style="width: 80px;">
                <select id="online">
                    <option value="false">–û—Ñ—Ñ–ª–∞–π–Ω</option>
                    <option value="true">–í –∏–≥—Ä–µ</option>
                </select>
                <button class="btn-add" onclick="saveMember()">–°–û–•–†–ê–ù–ò–¢–¨ –í –ë–ê–ó–£</button>
            </div>
        </div>

        <h2>–¢–µ–∫—É—â–∏–π —Å–æ—Å—Ç–∞–≤</h2>
        <table id="memberTable">
            <thead>
                <tr>
                    <th>–ù–∏–∫</th>
                    <th>–†–∞–Ω–≥</th>
                    <th>–í—ã–≥–æ–≤–æ—Ä—ã</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        async function loadMembers() {
            const res = await fetch('/admin/get-members');
            const members = await res.json();
            const tbody = document.querySelector('#memberTable tbody');
            tbody.innerHTML = '';

            members.forEach(m => {
                tbody.innerHTML += `
                    <tr>
                        <td><b>${m.name}</b></td>
                        <td>${m.rank}</td>
                        <td>
                            <button class="warn-btn" onclick="changeWarns('${m.name}', -1)">-</button>
                            <span class="warn-count">${m.warns || 0}</span>
                            <button class="warn-btn" onclick="changeWarns('${m.name}', 1)">+</button>
                        </td>
                        <td class="${m.online ? 'status-online' : 'status-offline'}">${m.online ? '–í –∏–≥—Ä–µ' : '–û—Ñ—Ñ–ª–∞–π–Ω'}</td>
                        <td>
                            <button class="btn-edit" onclick="fillForm('${m.name}', '${m.rank}', ${m.warns}, ${m.online})">üìù</button>
                            <button class="btn-del" onclick="deleteMember('${m.name}')">‚ùå</button>
                        </td>
                    </tr>
                `;
            });
        }

        async function changeWarns(name, delta) {
            const password = document.getElementById('pass').value;
            if(!password) return alert("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞ —Å–≤–µ—Ä—Ö—É!");

            const res = await fetch('/admin/update-warns', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ password, name, delta })
            });

            if(res.ok) {
                loadMembers();
            } else {
                alert("–û—à–∏–±–∫–∞! –ü—Ä–æ–≤–µ—Ä—å –ø–∞—Ä–æ–ª—å.");
            }
        }

        function fillForm(name, rank, warns, online) {
            document.getElementById('name').value = name;
            document.getElementById('rank').value = rank;
            document.getElementById('warns').value = warns;
            document.getElementById('online').value = online.toString();
            window.scrollTo(0,0);
        }

        async function saveMember() {
            const data = {
                password: document.getElementById('pass').value,
                name: document.getElementById('name').value,
                rank: document.getElementById('rank').value,
                warns: parseInt(document.getElementById('warns').value),
                online: document.getElementById('online').value === "true"
            };

            const res = await fetch('/admin/update-member', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });

            if(res.ok) { loadMembers(); } else { alert("–û—à–∏–±–∫–∞!"); }
        }

        async function deleteMember(name) {
            const password = document.getElementById('pass').value;
            if(!password) return alert("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞!");
            if(!confirm(`–£–≤–æ–ª–∏—Ç—å ${name}?`)) return;

            const res = await fetch('/admin/delete-member', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({password, name})
            });
            if(res.ok) { loadMembers(); }
        }

        loadMembers();
    </script>
</body>
</html>
